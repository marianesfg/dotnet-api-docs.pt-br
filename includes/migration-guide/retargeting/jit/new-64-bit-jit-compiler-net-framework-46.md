### <a name="new-64-bit-jit-compiler-in-the-net-framework-46"></a>Novo compilador JIT de 64 bits no .NET Framework 4.6

|   |   |
|---|---|
|Detalhes|A partir do .NET Framework 4.6, um novo compilador JIT de 64 bits é usado para compilação Just-In-Time. Em alguns casos, será gerada uma exceção inesperada ou um comportamento diferente será observado se um aplicativo for executado usando o compilador de 32 bits ou o compilador JIT de 64 bits antigo. Essa alteração não afeta o compilador JIT de 32 bits. As diferenças conhecidas incluem o seguinte:<ul><li>Sob certas condições, uma operação de conversão unboxing pode gerar uma <xref:System.NullReferenceException> em compilações de Versão com a otimização ativada.</li><li>Em alguns casos, a execução do código de produção em um corpo de método grande pode gerar uma <xref:System.StackOverflowException>.</li><li>Em certas condições, as estruturas passadas para um método são tratadas como tipos de referência em vez de tipos de valor em de builds de Versão. Um das manifestações desse problema é que os itens individuais em uma coleção aparecem em uma ordem inesperada.</li><li>Sob determinadas condições, a comparação de valores <xref:System.UInt16> com seu conjunto de bits alto será incorreta se a otimização estiver habilitada.</li><li>Sob certas condições, especialmente ao inicializar uma matriz de valores, a inicialização da memória pela instrução IL <xref:System.Reflection.Emit.OpCodes.Initblk?displayProperty=nameWithType> pode inicializar a memória com um valor incorreto. Isso pode resultar em uma saída incorreta ou uma exceção sem tratamento.</li><li>Sob certas condições raras, um teste de bits condicional poderá retornar o valor <xref:System.Boolean> incorreto ou gerar uma exceção se as otimizações do compilador estiverem habilitadas.</li><li>Sob certas condições, se uma instrução <code>if</code> for usada para testar uma condição antes de entrar em um bloco <code>try</code>, e na saída do bloco <code>try</code>, e a mesma condição for avaliada no bloco <code>catch</code> ou <code>finally</code>, o novo compilador JIT de 64 bits removerá a condição <code>if</code> do bloco <code>catch</code> ou <code>finally</code> durante a otimização do código. Como resultado, o código dentro da instrução <code>if</code> no bloco <code>catch</code> ou <code>finally</code> será executado incondicionalmente.</li></ul>|
|Sugestão|<strong>Mitigação de problemas conhecidos</strong> Se você encontrar os problemas listados acima, solucione-os seguindo um destes procedimentos:<ul><li>Atualizar para o .NET Framework 4.6.2. O novo compilador de 64 bits incluído com o .NET Framework 4.6.2 resolve cada um desses problemas conhecidos.</li><li>Verifique se a sua versão do Windows está atualizada executando o Windows Update. Atualizações de serviço para o .NET Framework 4.6 e 4.6.1 resolvem cada um desses problemas, exceto a <xref:System.NullReferenceException> em uma operação de conversão unboxing.</li><li>Compilar com o compilador JIT de 64 bits mais antigo. Veja a seção <strong>Mitigação de outros problemas</strong> para saber mais sobre como fazer isso.</li></ul><strong>Mitigação de outros problemas</strong> Se você encontrar qualquer outra diferença de comportamento entre o código compilado com o compilador de 64 bits mais antigo e o novo compilador JIT de 64 bits, ou entre as versões de depuração e de versão de seu aplicativo, ambas compiladas com o novo compilador JIT de 64 bits, faça o seguinte para compilar o aplicativo com o compilador JIT de 64 bits mais antigo:<ul><li>Adicione a cada aplicativo o elemento [\<useLegacyJit>](~/docs/framework/configure-apps/file-schema/runtime/uselegacyjit-element.md) ao arquivo de configuração do aplicativo. Veja a seguir como desabilitar a compilação com o novo compilador JIT de 64 bits e usar, em vez disso, o compilador JIT de 64 bits herdado.</li></ul><pre><code class="language-xml">&lt;?xml version =&quot;1.0&quot;?&gt;&#13;&#10;&lt;configuration&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;useLegacyJit enabled=&quot;1&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre><ul><li>Adicione a cada usuário um valor <code>REG_DWORD</code> denominado <code>useLegacyJit</code> para a chave <code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\.NETFramework</code> do Registro. Um valor 1 habilita o compilador JIT de 64 bits herdado; um valor 0 o desabilita e habilita o novo compilador JIT de 64 bits.</li><li>Adicione a cada máquina um valor <code>REG_DWORD</code> denominado <code>useLegacyJit</code> para a chave <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework</code> do Registro. Um valor de <code>1</code> habilita o compilador JIT de 64 bits herdado; um valor de <code>0</code> o desabilita e habilita o novo compilador JIT de 64 bits.</li></ul>Avise-nos sobre o problema relatando um bug no [Microsoft Connect](https://connect.microsoft.com/VisualStudio).|
|Escopo|Microsoft Edge|
|Versão|4.6|
|Tipo|Redirecionando|

